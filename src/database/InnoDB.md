# InnoDB


## 缓存池
由于InnoDB存储是基于磁盘的，因此从内存中划出一块缓存池来解决CPU与磁盘读写速度差异问题。

### 组成
1、数据页
2、索引页
3、插入缓冲
4、锁信息
5、自适应哈希索引
6、数据字典信息

### 读操作
先从缓存池中读，若缓存翅中不存在则读取磁盘（缓存命中），同时将数据页写入缓存

### 写操作
写到缓存池中，按一定频率进行刷盘，触发刷盘条件即为Checkpoint

### LRU
缓存池管理数据页使用最近最少使用算法，最频繁使用的页放在列表前端，当缓冲池无法放入新的数据页，释放列表微端的旧数据页

### 脏页
缓冲池中的页被修改，与磁盘的页数据不一致
注意！与脏数据不一样

## Checkpoint
提交事务时，先写日志，再修改，防止宕机导致数据丢失
### 目的
1、缩短数据库的恢复时间
2、缓冲池不够用时，刷新脏页到磁盘
3、重做日志不可用时，刷新脏页

## InnoDB关键特性
### 插入缓冲
对于聚集索引而言，决定了数据的插入基本是顺序的。但若存在非聚集索引，大概率是一个随机写的过程。若每一次写入，都要讲非聚集索引写入到真正的位置，无疑是很消耗时间的。现在将其放入到插入缓冲中，因为累积的过程中很可能存在多个靠在一起的非聚集索引，这样可以将多个插入合并，再以一定频率刷盘到叶子节点上。
### 两次写
在将脏页刷盘的时候，实际上会先将其在内存中的doublewriter buffer写两次，再调用刷盘。如果其中一个页在刷盘时崩溃，可以有副本参考
### 自适应哈希索引（AHI）
InnoDB中的哈希索引不能人为建立，而是自动根据访问频率来自动为某些热点页建立哈希索引。
### 异步IO
### 刷新邻接页
刷新脏页时会查看所在区的所有页，如果有脏页就一起刷了

## 存储结构
表->段->区->页->行